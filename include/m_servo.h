
/*******************************************************************************************
  @ 婵犵數濮烽弫鍛婃叏娴兼潙鍨傜憸鐗堝笚閸婂爼鏌涢鐘插姎闁汇倗鍋撶换婵囩節閸屾稑娅ら梺鍝ュТ濡繈寮婚妸鈺佺睄闁搞儺鐓堝Λ鍕磽娴ｇǹ顣抽柛瀣枛楠炲顫㈠畝鈧悿鈧┑鐐村灦椤洭藝椤曗偓濮婅櫣鎹勯妸銉︾彚闂佺懓鍤栭幏锟�  Mr_Wang_Tju
闂傚倸鍊搁崐宄懊归崶顒€纾婚柟閭﹀幘娴犳岸姊绘担绛嬪殭缂佺粯鍨块幊婵囥偅閸愩劎鍘撮梺鍛婂姦閸犳牠鎮為崹顐犱簻闁瑰搫妫楁禍楣冩⒒閸パ屾█闁哄被鍔岄埞鎴﹀幢濞嗗浚鏉哥紓浣鸿檸閸樺ジ鎮ユ總绋胯摕闁斥晛鍟刊鎾⒒閸喓鈻撻柛瀣尭閳规垿宕卞▎鎰啎婵犵數鍋涘Λ娆撳箰婵犳艾鍚圭€广儱顦伴悡蹇擃熆閼哥數娲存俊缁㈠枟閵囧嫰寮捄銊愌囨煛瀹€鈧崰鏍箖閳╁啯鍎熼柨婵嗘閸犳牠姊绘担鍝ョШ闁逞屽墯缁嬫挾绮ｉ弮鈧妵鍕閳ュ啿鎽甸梺绯曟櫔缁绘繂鐣烽妸鈺婃晣闁绘劕寮剁亸瀣⒒閸屾瑦绁版繛澶嬫礋瀹曟娊鏁冮崒姘鳖唵闂佽法鍣﹂幏锟�
婵犵數濮烽弫鎼佸磻閻愬搫鍨傞柛顐ｆ礀缁犳澘螖閿濆懎鏆欑痪鎯ф健閺屾洟宕煎┑鎰﹂梺钘夊暟閸犳牠寮婚敐澶婃闁圭ǹ瀛╅崰鎰版⒑閼姐倕鏋庣紓宥咃躬楠炲啳銇愰幒鎴犵暢闂佸湱鍎ら崹鐢糕€栨径鎰拺闁告繂瀚ˉ婊呯磼缂佹﹫鑰跨€殿喖顭烽幃銏ゆ偂鎼达綁鐛撻梻浣烘嚀閻°劎鎹㈤崘褏鏄傛繝鐢靛Х閺佸憡鎱ㄩ銏犵；闁圭偓鐣禍婊堢叓閸ャ劍灏伴柛锝勭矙閺屽秶绱掑Ο鐑╂嫽闂侀€炲苯澧紒鐘茬Ч瀹曟洟宕￠悘缁樻そ婵℃悂鍩℃担瑙勑氶梻浣瑰缁嬫垹鈧凹鍠氭竟鏇㈡嚃閳规儳浜鹃柛蹇擃槸娴滈箖姊洪崨濠傚闁告柨閰ｅ畷銏ゎ敃閳垛晜鏂€闂佺粯锕╅崑鍕閻愵剛绠鹃悗鐢登圭敮鍫曟煟鎺抽崝鎴濈暦閻㈢鍋撻敐搴℃灍闁绘挻娲橀妵鍕敇閻旈浠存繛瀛樼矋缁诲嫮妲愰幒妤€惟闁挎洍鍋撻柛婵堝劋閹便劍绻濋崘鈹夸虎濡炪們鍨哄ú鐔煎极閹版澘鐐婇柍杞扮缂嶅棙绻濋悽闈涘壋缂佽尪妫勭叅闁靛牆顦伴弲婵囥亜韫囨挸顏柡鍡畵濮婁粙宕堕埡鍐х瑝濠电偞鍨堕敃鈺侇焽閳哄懏鐓熼柟鎯у暱椤掋垽鏌￠崱鎰姦婵﹦绮幏鍛驳鐎ｎ亝鐣伴梻浣规偠閸斿宕￠幎鐣屽祦濠电姴鍟崕鐔兼煏婵炲灝鍔ら柣娑栧劦閺岋綀绠涢弴鐐扮捕婵犫拃鍌滅煓闁糕斂鍨藉顕€宕奸悢灏佸亾閻㈠憡鐓ユ繝闈涙閳ь剛鎳撻埢宥夊川鐎涙鍘撻柣鐘叉穿鐏忔瑧绮绘繝姘厸鐎光偓鐎ｎ剛袦闂佺硶鏂侀崑鎾愁渻閵堝棗鍧婇柛瀣尭閳规垿顢欓悷棰佸婵犵绱曢崑鎴﹀磹閺嶎灐鍝勎熼搹瑙勬畷闂佸綊妫跨粈浣虹不閻樺磭绡€濠电姴鍊绘晶鏇㈡煕閵娿儱鈧綊濡甸崟顖氱疀闁告挷鐒﹂崑褔姊哄Ч鍥у妞ゎ厼鍢查～蹇撁洪鍜佹濠电偞鍨堕悷顖毼涘☉銏♀拺闁绘挸娴烽弸鍐煕閳哄倻澧辩紒顔规櫊閹垽鎮℃惔锝庡敽闂備礁鎼崐鍛婃櫠娴犲绀堥柕濞炬櫆閳锋垹绱掗娑欑濠⒀勭叀閺屻倛銇愰幒鏃傛毇闂佽鍣换婵嬬嵁閸ヮ剚鍋嬮柛顐犲灩楠炴劙姊绘担绋款棌闁稿鎸惧濠冦偅閸愩剮銉╂煕閹扳晛濡烽柡鈧禒瀣厽闁归偊鍓欑痪褔鏌涢悩绛硅€块柡宀€鍠栭、娆撴嚒閵堝洨鍘┑鐘殿暯閸撴繈骞冮崒娑楃箚闁绘垼妫勫敮闂佹寧姊婚崑鎾诡枀闂傚倸鍊搁崐宄懊归崶褜娴栭柕濞炬櫆閸婂潡鏌ㄩ弴妤€浜惧銈庡幖閻忔繈锝炲⿰鍫濈劦妞ゆ帒瀚粻姘舵煕閹扳晛濡烽柡鈧禒瀣厱妞ゆ劑鍊曢弸搴ㄦ煛閸涱喖鈻曟慨濠冩そ瀹曘劍绻濇担铏圭畳闂備礁鎲￠幐鑽ゆ崲閸曨厼鍨濋柛顐熸噰閸嬫捇鏁愭惔鈩冪亪缂備胶濮寸紞濠傤嚕閸洖閱囬柕蹇曞С婢规洟鏌ｆ惔銏㈠暡闁瑰嚖鎷�
*******************************************************************************************/

#ifndef M_SERVO_H
#define M_SERVO_H
#include "HardwareSerial.h"
#include <Arduino.h>
class m_servo
{
public:
     m_servo(byte choose); //闂傚倸鍊搁崐椋庣矆娓氣偓楠炴牠顢曢敂缁樻櫈闂佸憡渚楅崹顏堝磻閹炬剚娼╂い鎰╁灩缁侇噣姊虹化鏇熸澒闁稿鎸搁—鍐Χ閸℃鐟ㄩ梺绋匡功鏋柣鈽嗗弮濮婄粯鎷呯憴鍕哗闂佺ǹ锕ョ换鍐矉瀹ュ洦宕夊〒姘煎灠濞堛劌顪冮妶鍡楀Ё闂傚嫬瀚板鏌ュ箹娴ｅ湱鍙嗛梺缁樻礀閸婂湱鈧熬鎷�
     void senddata(char kk);
     void set_angle(int id_num, float angle, int step);
     void set_angles(int id_list[20], float angle_list[20], int step, int n);
     void change_mode(int id_num, int mode_num);
     void set_id(int id_num, int id_new);
     void set_pid(int id_num, int pid);
     float get_state(int id_num, int para_num, int o_m);
     void set_speed(int id_num, int speed);
     void set_torque(int id_num, float torque);
     void write_e2(int id_num, int address, int value);
     int read_e2(int id_num, int address);
     void read_e2_all(int id_num);
     void unlock_stall(int id_num);
     void e2_init(int id_num);
     void temprature_set(int id_num, int temprature);
     void preset_angle(int id_num, float angle, int step, int rn);
     struct MotorParameter
     {
          float cur_angle = 0; //闂備礁鎼ˇ顐﹀疾濠婂牆钃熼柕濞垮剭濞差亝鏅搁柨鐕傛嫹 闂傚倷娴囬崑鎰仚闂佽绻戦懝楣冨煘閸愵喖鐒垫い鎺戝閸婄敻鏌涢敂璇插箹濞寸姾椴告穱濠勭磼閵忕姷浠梺鐟板级閹告娊鐛幒妤€绠ｆ繝鍨姇閺侊拷
          float exp_angle;     //闂備礁鎼ˇ顐﹀疾濠婂牆钃熼柕濞垮剭濞差亝鏅搁柨鐕傛嫹 闂傚倷绀侀幖顐︽偋韫囨稑绐楅柟閭﹀墾閼版寧绻濇繝鍌涘櫤闁哥姴妫濋弻鐔兼倻濡櫣浠村銈嗘閹凤拷
          int servo_rdata[16];
          float servo_rpara[9]; //闂備礁鎼ˇ顐﹀疾濠婂牆钃熼柕濞垮剭濞差亜鍐€妞ゆ挾鍋熼悡鎴︽⒑缁嬫寧婀扮紒瀣笒閳绘捇宕奸弴鐔哄幐婵炶揪绲块幊鎾凰夌€ｎ剛纾兼い鏇炴鐎氾拷
          int servo_mode;         //闂備礁鎼ˇ顐﹀疾濠婂牆钃熼柕濞垮剭濞差亝鏅搁柨鐕傛嫹 闂傚倷娴囬崑鎰仚闂佽绻戦懝楣冨煘閸愵喖鐒垫い鎺戝€甸崑鎾舵喆閸曨剙浠╅梺绋垮婢瑰棛妲愰悙鍝勬閻犲洤澧介崰鏍垂閹呮殾闁搞儮鏅╅弨锟�
          float cur_Voltage;     //闂備礁鎼ˇ顐﹀疾濠婂牆钃熼柕濞垮剭濞差亝鏅搁柨鐕傛嫹 闂傚倷娴囬崑鎰仚闂佽绻戦懝楣冨煘閸愵喖鐒垫い鎺戝€归崰鎰版煟濡も偓閻楀﹦浜搁鐑嗙唵鐟滃繑绻涢埀顒勬煙椤旇崵鐭欐俊顐㈠暙閳藉螣绾板彉绱�
          float cur_current;     //闂備礁鎼ˇ顐﹀疾濠婂牆钃熼柕濞垮剭濞差亝鏅搁柨鐕傛嫹 闂傚倷娴囬崑鎰仚闂佽绻戦懝楣冨煘閸愵喖鐒垫い鎺戝€归崰鎰版煟濡も偓閻楀﹦浜搁鐑嗙唵鐟滃繑绻涢埀顒勬煙椤旇崵鐭欑€规洖缍婇、鏇㈠Χ閸愩劋鍠�
          long baud_rate;         //闂備礁鎼ˇ顐﹀疾濠婂牆钃熼柕濞垮剭濞差亝鏅搁柨鐕傛嫹 闂傚倷娴囬崑鎰仚闂佽绻戦懝楣冨煘閸愵喖鐒垫い鎺嶈兌缁犳儳顭跨捄铏瑰闁诲浚鍠栭…璺ㄦ喆閸曨偅璇為梺璇″枟婵炲﹪寮幘缁樻櫢闁跨噦鎷�
          float cur_temprature;  //闂備礁鎼ˇ顐﹀疾濠婂牆钃熼柕濞垮剭濞差亝鏅搁柨鐕傛嫹 闂傚倷娴囬崑鎰仚闂佽绻戦懝楣冨煘閸愵喖鐒垫い鎺戝€归崰鎰版煟濡も偓閻楀﹦浜搁鐑嗙唵鐟滃繑鎱ㄩ幘顔嘉ラ柟鐑橆殔閻撴稑霉閿濆懎顥忛柛鐑囨嫹
     } Para; 
private:
     byte choose;                                                            //闂傚倸鍊搁崐鎼佸磹妞嬪孩顐介柨鐔哄Т绾惧鏌涢弴銊ョ€柛銉墮缁犮儲銇勯弮鍌涘殌濞存粎鍋撻幈銊╂晲閸よ棄缍婇幃浼存儌閻敹no婵犵數濮烽弫鎼佸磻閻愬搫鍨傞柛顐ｆ礀缁犱即鏌￠崟顐ょ疄濞存粌缍婇弻娑㈠箛闂堟稑绠叉繛瀛樼矊缂嶅﹪寮婚妸鈺傚亞闁稿本绋戦锟�
     int servo_sdata[10] = {0x7b, 0x79, 0, 0, 0, 0, 0x10, 0x10, 0x10, 0x7d}; //闂傚倸鍊搁崐鎼佸磹閹间礁纾归柟闂寸绾剧懓顪冪€ｎ亝鎹ｉ柣顓炴閵嗘帒顫濋敐鍛婵°倗濮烽崑娑⑺囬悽绋挎瀬闁瑰墽绮崑鎰版煕閹邦垰绱﹂柣銏狀煼濮婄粯鎷呴悷閭﹀殝濠电偛寮堕悧鐘茬暦閹版澘绠瑰ù锝嚽归悗顓㈡⒑缁嬭法鐏遍柛瀣仱閹繝寮撮悩鍐叉瀾闁瑰吋鐣崝濠囧焵椤掆偓閸熸潙鐣烽妸褉鍋撳☉娅亪鍩€椤掆偓濞硷繝寮诲☉鈶┾偓锕傚箣濠靛懐鎸夊┑鐐茬摠缁秶鍒掗幘璇茶摕闁绘柨鎲＄紞鍥煕閹炬鎯欓幋鐘电＜缂備降鍨归獮鏍煟閺嵮佸仮鐎殿喛顕ч埥澶愬閻樻剚妫熼梺鑽ゅУ娴滀粙宕滄潏顐▌闂佸搫澶囬埀顒€纾弳鍡涙倵閿濆骸澧伴柣锕€鐗撻幃妤冩喆閸曨剛顦ラ悗瑙勬处閸撶喖宕洪姀鈩冨劅闁靛牆娲ㄩ弶鎼佹⒑閸濆嫬鏆欓柛濠囶棑閼鸿京鈧潧鎽滅壕浠嬫煕鐏炴崘澹橀柍褜鍓欓崲鏌ユ箒闂佹悶鍎崝濠冪閸儲鐓曟繝闈涘閸旀粓鏌￠崱妯肩煉闁哄被鍔戦幃銏ゅ传閸曟垯鍨介弻锛勨偓锝傛櫇缁愭棃鏌″畝鈧崰鏍х暦濠婂棭妲鹃柣銏╁灡閻╊垶寮婚敓鐘插窛妞ゆ棁妫勯埀顒佸姍閺岋紕浠︾拠鎻掝潎闂佽鍠撻崐婵嗙暦閹烘垟妲堟慨妤€妫旂槐锟�  10bit
     int servo_sdata1[4] = {0x7E, 0, 0, 0};
     int i, id_num, step, rn, n, rem_step, id_number, address, value, id_new;
     float angle;
     int flag_serial = 0;
     String data;
     int u_numm;
     
};

#endif
